<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parent Pal MCP Client</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 10px 0; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
        .result { background: white; padding: 15px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
    </style>
</head>
<body>
    <h1>üéâ Parent Pal MCP Client</h1>
    
    <div class="container">
        <h3>üîê Authentication</h3>
        <input type="email" id="email" placeholder="Email" value="adi+testii33@gmail.com">
        <input type="password" id="password" placeholder="Password" value="Neo123456!">
        <button onclick="authenticate()">Authenticate</button>
        <div id="authResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h3>üìÖ Fetch Events by Category</h3>
        <select id="category">
            <option value="holiday">Holiday</option>
            <option value="birthday">Birthday</option>
            <option value="health">Health</option>
            <option value="education">Education</option>
        </select>
        <button onclick="fetchByCategory()">Fetch Events</button>
        <div id="categoryResult" class="result" style="display: none;"></div>
    </div>

    <div class="container">
        <h3>‚è∞ Fetch Nearest Events</h3>
        <input type="number" id="days" placeholder="Days" value="60">
        <button onclick="fetchNearest()">Fetch Events</button>
        <div id="nearestResult" class="result" style="display: none;"></div>
    </div>

    <script>
        const SERVER_URL = 'http://localhost:8001';
        let sessionId = null;
        let userId = null;

        async function getSessionId() {
            if (sessionId) return sessionId;
            
            const response = await fetch(`${SERVER_URL}/mcp`);
            const text = await response.text();
            const match = text.match(/sessionId=([a-f0-9-]+)/);
            if (match) {
                sessionId = match[1];
                return sessionId;
            }
            throw new Error('Could not get session ID');
        }

        async function callMCPTool(toolName, arguments) {
            const sessionId = await getSessionId();
            const response = await fetch(`${SERVER_URL}/mcp/messages?sessionId=${sessionId}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    jsonrpc: '2.0',
                    id: Date.now(),
                    method: 'tools/call',
                    params: { name: toolName, arguments }
                })
            });
            return await response.json();
        }

        async function authenticate() {
            try {
                const result = await callMCPTool('authenticate-user', {
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value
                });
                
                const resultDiv = document.getElementById('authResult');
                resultDiv.style.display = 'block';
                
                if (result.result) {
                    userId = result.result.content[0].text;
                    resultDiv.innerHTML = `<strong>‚úÖ Success!</strong><br>User ID: ${userId}`;
                    resultDiv.className = 'result';
                } else {
                    resultDiv.innerHTML = `<strong>‚ùå Error:</strong><br>${result.error?.message || 'Authentication failed'}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                const resultDiv = document.getElementById('authResult');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong><br>${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function fetchByCategory() {
            if (!userId) {
                alert('Please authenticate first!');
                return;
            }
            
            try {
                const result = await callMCPTool('fetch-events-by-category', {
                    category: document.getElementById('category').value,
                    userId: userId
                });
                
                const resultDiv = document.getElementById('categoryResult');
                resultDiv.style.display = 'block';
                
                if (result.result) {
                    const events = result.result.structuredContent.events || [];
                    resultDiv.innerHTML = `<strong>‚úÖ Found ${events.length} events</strong><br><pre>${JSON.stringify(events, null, 2)}</pre>`;
                    resultDiv.className = 'result';
                } else {
                    resultDiv.innerHTML = `<strong>‚ùå Error:</strong><br>${result.error?.message || 'Failed to fetch events'}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                const resultDiv = document.getElementById('categoryResult');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong><br>${error.message}`;
                resultDiv.className = 'result error';
            }
        }

        async function fetchNearest() {
            if (!userId) {
                alert('Please authenticate first!');
                return;
            }
            
            try {
                const result = await callMCPTool('fetch-nearest-events', {
                    days: parseInt(document.getElementById('days').value),
                    userId: userId
                });
                
                const resultDiv = document.getElementById('nearestResult');
                resultDiv.style.display = 'block';
                
                if (result.result) {
                    const events = result.result.structuredContent.events || [];
                    resultDiv.innerHTML = `<strong>‚úÖ Found ${events.length} events in next ${document.getElementById('days').value} days</strong><br><pre>${JSON.stringify(events, null, 2)}</pre>`;
                    resultDiv.className = 'result';
                } else {
                    resultDiv.innerHTML = `<strong>‚ùå Error:</strong><br>${result.error?.message || 'Failed to fetch events'}`;
                    resultDiv.className = 'result error';
                }
            } catch (error) {
                const resultDiv = document.getElementById('nearestResult');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<strong>‚ùå Error:</strong><br>${error.message}`;
                resultDiv.className = 'result error';
            }
        }
    </script>
</body>
</html>
